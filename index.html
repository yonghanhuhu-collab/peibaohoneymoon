<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å—ç¾©èœœæœˆ ğŸ‡®ğŸ‡¹</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* è«è˜­è¿ªè‰²ç³» (Morandi Colors) */
            --primary: #7A9CA5;      /* ç°è—ç¶  (ä¸»è‰²) */
            --bg: #F4F6F4;           /* æ¥µæ·ºç°ç¶ èƒŒæ™¯ */
            --card: #FFFFFF;
            --text: #465C63;         /* æ·±ç°ç¶ å­—é«” */
            --accent: #D4A5A5;       /* è«è˜­è¿ªç²‰ (é‡é»è‰²) */
            
            /* åˆ†é¡æ¨™ç±¤é¡è‰² */
            --tag-spot: #8DA399;     /* æ™¯é»-ç¶  */
            --tag-food: #D4A5A5;     /* ç¾é£Ÿ-ç²‰ */
            --tag-coffee: #C5B088;   /* å’–å•¡-æ£• */
            --tag-trans: #8FA4B5;    /* äº¤é€š-è— */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 95px; }

        /* === 1. Header (æ—¥æœŸ + é—œéµå­— + å¤©æ°£) === */
        .header-section {
            background: var(--primary);
            padding: 20px 0 15px;
            border-radius: 0 0 30px 30px;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 5px 20px rgba(122, 156, 165, 0.3);
            color: white;
        }
        .header-top { display: flex; justify-content: space-between; padding: 0 20px 15px; align-items: center; }
        .app-name { font-family: 'Playfair Display', serif; font-size: 22px; letter-spacing: 1px; }
        
        .daily-info { padding: 0 20px 10px; animation: fadeIn 0.5s; }
        .daily-highlight { font-size: 18px; font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .daily-weather { font-size: 13px; opacity: 0.9; display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; width: fit-content; }

        /* æ—¥æœŸæ»‘å‹•åˆ— */
        .date-scroller {
            display: flex; overflow-x: auto; padding: 0 15px; gap: 10px;
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .date-scroller::-webkit-scrollbar { display: none; }
        .date-card {
            background: rgba(255,255,255,0.25); min-width: 60px; height: 60px;
            border-radius: 16px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            flex-shrink: 0; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.1);
        }
        .date-card.active {
            background: white; color: var(--primary); transform: scale(1.05); font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* === 2. è¡Œç¨‹å¡ç‰‡ === */
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }

        .timeline-item { display: flex; gap: 12px; margin-bottom: 20px; position: relative; }
        .timeline-item::before { /* é€£æ¥ç·š */
            content: ''; position: absolute; left: 24px; top: 40px; bottom: -30px;
            width: 2px; background: #E0E6E8; z-index: 0;
        }
        .timeline-item:last-child::before { display: none; }

        .time-badge {
            background: white; color: var(--primary); font-weight: bold; font-size: 12px;
            width: 50px; height: 50px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; z-index: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); flex-shrink: 0; border: 2px solid var(--bg);
        }

        .trip-card {
            flex: 1; background: white; border-radius: 18px; padding: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); display: flex; gap: 12px;
            position: relative; overflow: hidden;
        }
        .tag {
            position: absolute; top: 0; right: 0; padding: 3px 10px;
            font-size: 10px; color: white; border-radius: 0 18px 0 10px; font-weight: bold;
        }
        .trip-img {
            width: 80px; height: 80px; border-radius: 12px; object-fit: cover; background: #eee;
        }
        .trip-content { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .trip-title { font-size: 16px; font-weight: bold; margin-bottom: 4px; color: #333; }
        .trip-desc { font-size: 12px; color: #888; margin-bottom: 6px; }
        .nav-btn-sm {
            background: #F2F7F8; color: var(--primary); font-size: 11px; padding: 4px 8px;
            border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 4px; width: fit-content;
        }

        /* === 3. è¨˜å¸³èˆ‡çµç®— === */
        .balance-card {
            background: linear-gradient(135deg, #7A9CA5 0%, #5F7D85 100%);
            border-radius: 20px; padding: 20px; color: white; margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(122, 156, 165, 0.3); position: relative;
        }
        .balance-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .settle-box {
            background: rgba(255,255,255,0.95); color: #333; padding: 15px; border-radius: 15px;
            margin-top: 15px; font-size: 14px; display: flex; align-items: center; gap: 10px;
        }
        .settle-icon { width: 30px; height: 30px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        .expense-list { padding-bottom: 80px; }
        .expense-item {
            background: white; padding: 15px; border-radius: 14px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .cat-icon {
            width: 36px; height: 36px; background: #F4F6F4; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; color: var(--primary); margin-right: 12px;
        }

        /* === 4. åº•éƒ¨å°èˆª & FAB === */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            padding: 12px; border-radius: 25px; display: flex; justify-content: space-around;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); z-index: 900;
        }
        .nav-item {
            border: none; background: none; color: #B0B8BA;
            display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px;
        }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 20px; }

        .fab {
            position: fixed; bottom: 100px; right: 25px;
            background: var(--text); color: white; width: 55px; height: 55px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 800;
        }

        /* === 5. å½ˆçª—èˆ‡è¡¨å–® === */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000;
            display: none; align-items: flex-end;
        }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        .modal-sheet {
            background: white; width: 100%; border-radius: 24px 24px 0 0;
            padding: 30px 25px; animation: slideUp 0.3s;
        }
        .input-group { margin-bottom: 15px; }
        .input-row { display: flex; gap: 10px; }
        input, select {
            width: 100%; padding: 15px; border: 1px solid #eee; border-radius: 12px;
            font-size: 16px; background: #F9F9F9;
        }
        .currency-toggle {
            display: flex; background: #eee; padding: 4px; border-radius: 10px; margin-bottom: 15px;
        }
        .c-btn { flex: 1; padding: 8px; text-align: center; border-radius: 8px; font-size: 14px; color: #888; }
        .c-btn.active { background: white; color: var(--primary); font-weight: bold; shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .save-btn {
            width: 100%; padding: 16px; background: var(--primary); color: white;
            border: none; border-radius: 14px; font-size: 16px; font-weight: bold; margin-top: 10px;
        }

        /* ç¿»è­¯æŒ‰éˆ•æ¨£å¼ */
        .trans-btn {
            background: white; border-radius: 16px; padding: 20px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        
        @keyframes fadeIn { from{opacity:0} to{opacity:1}}
        @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)}}
    </style>
</head>
<body>

    <div class="header-section">
        <div class="header-top">
            <div class="app-name">Honeymoon ğŸ‡®ğŸ‡¹</div>
            <div style="font-size:12px; opacity:0.8;">Day <span id="dayCount">1</span></div>
        </div>
        
        <div class="daily-info">
            <div class="daily-highlight" id="dailyHighlight">
                </div>
            <div class="daily-weather" id="dailyWeather">
                </div>
        </div>

        <div class="date-scroller" id="dateTabs"></div>
    </div>

    <div id="view-schedule" class="view-section active">
        <div class="container" id="timelineList"></div>
    </div>

    <div id="view-wallet" class="view-section">
        <div class="container">
            <div class="balance-card">
                <div class="balance-row">
                    <div>
                        <div style="font-size:12px; opacity:0.8;">ç¸½æ”¯å‡º (EUR)</div>
                        <div style="font-size:28px; font-weight:bold;">â‚¬<span id="displayTotal">0</span></div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:12px; opacity:0.8;">å°å¹£ (TWD)</div>
                        <div style="font-size:20px;">$<span id="displayTotalTwd">0</span></div>
                    </div>
                </div>
            </div>

            <div class="settle-box">
                <div class="settle-icon"><i class="fas fa-hand-holding-dollar"></i></div>
                <div id="settleResult">ç›®å‰ç„¡å¸³ç›®ï¼Œå¿«å»è¨˜ä¸€ç­†ï¼</div>
            </div>

            <h3 style="margin-top:25px; color:var(--text); font-size:16px;">æ¶ˆè²»æ˜ç´°</h3>
            <div class="expense-list" id="expenseList"></div>
        </div>
        <button class="fab" onclick="openModal()"><i class="fas fa-plus"></i></button>
    </div>

    <div id="view-translate" class="view-section">
        <div class="container">
            <h3>å³æ™‚ç¿»è­¯</h3>
            <div class="trans-btn" onclick="openGoogleTrans('zh-TW', 'it')">
                <i class="fas fa-comment-dots" style="font-size:24px; color:var(--primary);"></i>
                <div>
                    <div style="font-weight:bold;">ä¸­ â” ç¾©</div>
                    <div style="font-size:12px; color:#888;">é»é¤ã€å•è·¯ã€è³¼ç‰©æ™‚ä½¿ç”¨</div>
                </div>
            </div>
            <div class="trans-btn" onclick="openGoogleTrans('it', 'zh-TW')">
                <i class="fas fa-microphone-alt" style="font-size:24px; color:var(--accent);"></i>
                <div>
                    <div style="font-weight:bold;">ç¾© â” ä¸­</div>
                    <div style="font-size:12px; color:#888;">é–‹å•ŸèªéŸ³è¾¨è­˜è½å°æ–¹èªª</div>
                </div>
            </div>

            <h3>æ±‚ç”Ÿç¾©å¤§åˆ©èª</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div class="trip-card" onclick="speak('Ciao')">
                    <div style="text-align:center; width:100%;">
                        <div style="font-weight:bold; color:var(--text);">Ciao</div>
                        <div style="font-size:12px; color:#999;">ä½ å¥½/å†è¦‹</div>
                    </div>
                </div>
                <div class="trip-card" onclick="speak('Grazie')">
                    <div style="text-align:center; width:100%;">
                        <div style="font-weight:bold; color:var(--text);">Grazie</div>
                        <div style="font-size:12px; color:#999;">è¬è¬</div>
                    </div>
                </div>
                <div class="trip-card" onclick="speak('Bagno')">
                    <div style="text-align:center; width:100%;">
                        <div style="font-weight:bold; color:var(--text);">Bagno</div>
                        <div style="font-size:12px; color:#999;">å»æ‰€</div>
                    </div>
                </div>
                <div class="trip-card" onclick="speak('CaffÃ¨')">
                    <div style="text-align:center; width:100%;">
                        <div style="font-weight:bold; color:var(--text);">Un CaffÃ¨</div>
                        <div style="font-size:12px; color:#999;">ä¸€æ¯å’–å•¡</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchView('schedule', this)">
            <i class="fas fa-map-location-dot"></i> è¡Œç¨‹
        </div>
        <div class="nav-item" onclick="switchView('wallet', this)">
            <i class="fas fa-wallet"></i> è¨˜å¸³
        </div>
        <div class="nav-item" onclick="switchView('translate', this)">
            <i class="fas fa-language"></i> ç¿»è­¯
        </div>
    </div>

    <div class="modal-overlay" id="addModal">
        <div class="modal-sheet">
            <h3>è¨˜ä¸€ç­† âœï¸</h3>
            
            <div class="currency-toggle">
                <div class="c-btn active" id="btnEur" onclick="setCurrency('EUR')">æ­å…ƒ (â‚¬)</div>
                <div class="c-btn" id="btnTwd" onclick="setCurrency('TWD')">å°å¹£ (NT$)</div>
            </div>

            <div class="input-group">
                <input type="text" id="exItem" placeholder="é …ç›® (ä¾‹å¦‚: æ™šé¤)">
            </div>
            
            <div class="input-row">
                <input type="number" id="exPrice" placeholder="é‡‘é¡">
                <select id="exCat">
                    <option value="food">ğŸ½ï¸ é¤é£²</option>
                    <option value="trans">ğŸš† äº¤é€š</option>
                    <option value="shop">ğŸ›ï¸ è³¼ç‰©</option>
                    <option value="hotel">ğŸ¨ ä½å®¿</option>
                    <option value="ticket">ğŸ« é–€ç¥¨</option>
                    <option value="other">âœ¨ å…¶ä»–</option>
                </select>
            </div>

            <div class="input-group">
                <select id="exPayer">
                    <option value="" disabled selected>èª°ä»˜éŒ¢ï¼Ÿ</option>
                    <option value="male">ğŸ¤µ ç”·æ–¹å…ˆä»˜</option>
                    <option value="female">ğŸ‘° å¥³æ–¹å…ˆä»˜</option>
                </select>
            </div>

            <button class="save-btn" onclick="saveExpense()">å„²å­˜</button>
            <div style="text-align:center; padding:15px; color:#999;" onclick="closeModal()">å–æ¶ˆ</div>
        </div>
    </div>

    <script>
        // === è³‡æ–™åº«ï¼šå·²å¹«ä½ è£œé½Šç…§ç‰‡ã€åˆ†é¡ã€å’–å•¡ã€ä¸‰é¤ ===
        const itinerary = [
            // Day 1
            { 
                date: "3/28", day: "äº”", highlight: "æ‹¿å¡é‡Œçš„æ··äº‚èˆ‡ç¾å‘³", weather: "â˜ï¸ 16Â°C",
                items: [
                    { time: "14:00", title: "æŠµé”æ‹¿å¡é‡Œ", desc: "NAP Airport æ¥æ©Ÿ", type: "trans", img: "https://images.unsplash.com/photo-1595842875154-e6593466a987?w=400", map: "Naples International Airport" },
                    { time: "15:30", title: "CaffÃ¨ Gambrinus", desc: "ç™¾å¹´å’–å•¡å»³å¿…å– (Cafe)", type: "coffee", img: "https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400", map: "Gran CaffÃ¨ Gambrinus" },
                    { time: "17:00", title: "å‰å¾€è˜‡é€£å¤š", desc: "é£¯åº— Check-in", type: "trans", img: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=400", map: "Sorrento" },
                    { time: "19:00", title: "Piazza Tasso æ™šé¤", desc: "æª¸æª¬é…’ Limoncello", type: "food", img: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=400", map: "Piazza Tasso Sorrento" }
                ]
            },
            // Day 2
            { 
                date: "3/29", day: "å…­", highlight: "å¡å¸ƒé‡Œå³¶çš„è—è‰²å¥‡è¹Ÿ", weather: "â˜€ï¸ 18Â°C",
                items: [
                    { time: "09:00", title: "å‰å¾€å¡å¸ƒé‡Œå³¶", desc: "æ­èˆ¹å‡ºç™¼", type: "trans", img: "https://images.unsplash.com/photo-1596395819057-d37f374e27da?w=400", map: "Port of Sorrento" },
                    { time: "10:30", title: "Piazzetta å–å’–å•¡", desc: "å³¶ä¸Šå®¢å»³çœ‹åäºº", type: "coffee", img: "https://images.unsplash.com/photo-1521017432531-fbd92d768814?w=400", map: "Piazzetta di Capri" },
                    { time: "12:00", title: "è—æ´ Blue Grotto", desc: "ä¸Šå¸èª¿å¥½çš„è—", type: "spot", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Grotta_Azzurra_II.jpg/600px-Grotta_Azzurra_II.jpg", map: "Blue Grotto" },
                    { time: "13:30", title: "æµ·é®®åˆé¤", desc: "Ristorante Michel'angelo", type: "food", img: "https://images.unsplash.com/photo-1626202378370-9856e729a997?w=400", map: "Ristorante Michel'angelo Capri" },
                    { time: "19:00", title: "Il Buco æ™šé¤", desc: "ç±³å…¶æ—æ¨è–¦æµ·é®®", type: "food", img: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400", map: "Il Buco Sorrento" }
                ]
            },
            // Day 3
            {
                date: "3/30", day: "æ—¥", highlight: "é˜¿ç‘ªè²æµ·å²¸æœ€ç¾å±±åŸ", weather: "â˜€ï¸ 19Â°C",
                items: [
                    { time: "10:00", title: "æ³¢è¥¿å¡”è«¾ Positano", desc: "çµ•ç¾å‚ç›´å±±åŸ", type: "spot", img: "https://images.unsplash.com/photo-1620921932662-7901777d19c0?w=400", map: "Positano" },
                    { time: "11:30", title: "æµ·æ™¯å’–å•¡", desc: "La Zagara æª¸æª¬è›‹ç³•", type: "coffee", img: "https://images.unsplash.com/photo-1595267591632-44e273f54546?w=400", map: "La Zagara Positano" },
                    { time: "13:00", title: "é˜¿ç‘ªè²ä¸»æ•™å ‚", desc: "å¿…æ‹ç¶“å…¸éšæ¢¯", type: "spot", img: "https://images.unsplash.com/photo-1635269628042-438459424855?w=400", map: "Amalfi Cathedral" },
                    { time: "14:00", title: "è·¯é‚Šå°åƒ", desc: "ç‚¸æµ·é®® Cuoppo", type: "food", img: "https://images.unsplash.com/photo-1598218671607-e54e488b394e?w=400", map: "Amalfi Coast" },
                    { time: "19:00", title: "é£¯åº—é™„è¿‘æ™šé¤", desc: "æ”¾é¬†ä¼‘æ¯", type: "food", img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400", map: "Sorrento" }
                ]
            },
            // Day 4
            {
                date: "3/31", day: "ä¸€", highlight: "ç©¿è¶Šæ™‚ç©ºåˆ°é¦¬æ³°æ‹‰", weather: "â˜ï¸ 15Â°C",
                items: [
                    { time: "09:00", title: "å‰å¾€é¦¬æ³°æ‹‰", desc: "è»Šç¨‹ç´„ 3.5 å°æ™‚", type: "trans", img: "https://images.unsplash.com/photo-1627918452778-98e3532f8661?w=400", map: "Matera" },
                    { time: "13:00", title: "è¼•é£Ÿåˆé¤", desc: "Puccia ç•¶åœ°ä¸‰æ˜æ²»", type: "food", img: "https://images.unsplash.com/photo-1619860601932-a5697aa62900?w=400", map: "Matera" },
                    { time: "15:00", title: "Sassi çŸ³çªŸæ°‘å±…", desc: "007 é›»å½±å ´æ™¯", type: "spot", img: "https://images.unsplash.com/photo-1563825832729-152cb5b7074c?w=400", map: "Sassi di Matera" },
                    { time: "16:30", title: "æ´ç©´å’–å•¡", desc: "CaffÃ¨ Vergnano", type: "coffee", img: "https://images.unsplash.com/photo-1497935586351-b67a49e012bf?w=400", map: "Matera Cafe" },
                    { time: "19:00", title: "å‚³çµ±è‚‰æ–™ç†", desc: "Osteria Pico", type: "food", img: "https://images.unsplash.com/photo-1544025162-d76690b6d012?w=400", map: "Osteria Pico Matera" }
                ]
            },
            // Day 5
            {
                date: "4/01", day: "äºŒ", highlight: "é«”é©—æ´ç©´ç”Ÿæ´»", weather: "â˜€ï¸ 17Â°C",
                items: [
                    { time: "09:00", title: "æ´ç©´é£¯åº—æ—©é¤", desc: "äº«å—æ™¨å…‰", type: "food", img: "https://images.unsplash.com/photo-1533038590840-1cde6e668a91?w=400", map: "Matera" },
                    { time: "11:00", title: "è‡ªç”±æ¢ç´¢", desc: "è¿·å¤±åœ¨å··å¼„ä¸­", type: "spot", img: "https://images.unsplash.com/photo-1555992828-ca4dbe41d294?w=400", map: "Matera" },
                    { time: "13:00", title: "æ™¯è§€åˆé¤", desc: "Regia Corte", type: "food", img: "https://images.unsplash.com/photo-1596521566895-c1341c5d72f9?w=400", map: "Regia Corte Matera" },
                    { time: "16:00", title: "é£¯åº—ä¼‘æ¯", desc: "äº«å—è¨­æ–½", type: "hotel", img: "https://images.unsplash.com/photo-1582719508461-905c673771fd?w=400", map: "Matera" },
                    { time: "19:00", title: "ç°¡å–®æ™šé¤", desc: "æŠ«è–©èˆ‡é…’", type: "food", img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400", map: "Matera" }
                ]
            },
            // Day 6
            {
                date: "4/02", day: "ä¸‰", highlight: "èµ°é€²ç«¥è©±è˜‘è‡æ‘", weather: "â˜€ï¸ 18Â°C",
                items: [
                    { time: "10:00", title: "å‰å¾€è˜‘è‡æ‘", desc: "Alberobello", type: "trans", img: "https://images.unsplash.com/photo-1529154036614-a60975f5c760?w=400", map: "Alberobello" },
                    { time: "12:30", title: "ç¾©å¼åˆé¤", desc: "L'Aratro", type: "food", img: "https://images.unsplash.com/photo-1498579150354-977475b7ea0b?w=400", map: "L'Aratro Alberobello" },
                    { time: "14:00", title: "Trulli åœŸåˆ©å±‹", desc: "Rione Monti æ¼«æ­¥", type: "spot", img: "https://images.unsplash.com/photo-1647447477626-d66827038e23?w=400", map: "Rione Monti" },
                    { time: "16:00", title: "ç‰¹è‰²å’–å•¡", desc: "åœ¨åœŸåˆ©å±‹å– Espresso", type: "coffee", img: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400", map: "Alberobello Cafe" },
                    { time: "19:00", title: "æ™®åˆ©äºé¢¨å‘³é¤", desc: "è²“è€³æœµéºµ Orecchiette", type: "food", img: "https://images.unsplash.com/photo-1627207644206-a2040d60ecad?w=400", map: "Alberobello" }
                ]
            },
            // Day 7
            {
                date: "4/03", day: "å››", highlight: "æ‡¸å´–ä¸Šçš„æµªæ¼«æ™šé¤", weather: "â˜€ï¸ 19Â°C",
                items: [
                    { time: "11:00", title: "æ³¢åˆ©å°¼äºè«¾", desc: "Polignano a Mare", type: "trans", img: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?w=400", map: "Polignano a Mare" },
                    { time: "12:30", title: "æ‡¸å´–æµ·ç˜", desc: "Lama Monachile", type: "spot", img: "https://images.unsplash.com/photo-1621689230554-07d4722a967f?w=400", map: "Lama Monachile" },
                    { time: "15:00", title: "Mojito å’–å•¡", desc: "ç•¶åœ°ç‰¹èª¿ Speciale", type: "coffee", img: "https://images.unsplash.com/photo-1574315042621-50e56598357f?w=400", map: "Polignano Cafe" },
                    { time: "18:00", title: "æ´ç©´é¤å»³", desc: "Grotta Palazzese (å¿…è¨‚)", type: "food", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Grotta_Palazzese_Restaurant.jpg/600px-Grotta_Palazzese_Restaurant.jpg", map: "Grotta Palazzese" }
                ]
            },
            // Day 8
            {
                date: "4/04", day: "äº”", highlight: "å·´é‡Œè€åŸçš„éºµé¦™", weather: "â˜ï¸ 17Â°C",
                items: [
                    { time: "10:00", title: "å·´é‡Œè€åŸ", desc: "Bari Vecchia", type: "spot", img: "https://images.unsplash.com/photo-1605206981987-a37eb5f0a0d4?w=400", map: "Bari Vecchia" },
                    { time: "11:30", title: "é˜¿å¬¤éºµè¡—", desc: "çœ‹é˜¿å¬¤æ‰‹ä½œè²“è€³æœµéºµ", type: "spot", img: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=400", map: "Strada delle Orecchiette" },
                    { time: "13:00", title: "è¡—é ­å°åƒ", desc: "Focaccia Barese", type: "food", img: "https://images.unsplash.com/photo-1601314167099-232737169c5a?w=400", map: "Panificio Fiore" },
                    { time: "15:00", title: "æœ€å¾Œå’–å•¡", desc: "CaffÃ¨ Vergnano", type: "coffee", img: "https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=400", map: "Bari Cafe" },
                    { time: "19:00", title: "å‘Šåˆ¥æ™šé¤", desc: "æµ·é®®å¤§é¤", type: "food", img: "https://images.unsplash.com/photo-1626804475297-411f7c1b4e5d?w=400", map: "Bari Restaurant" }
                ]
            },
            // Day 9
            {
                date: "4/05", day: "å…­", highlight: "å†è¦‹ç¾©å¤§åˆ©", weather: "âœˆï¸",
                items: [
                    { time: "09:00", title: "é£¯åº—æ—©é¤", desc: "æœ€å¾Œæ•´ç†", type: "food", img: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=400", map: "" },
                    { time: "11:00", title: "å‰å¾€æ©Ÿå ´", desc: "Bari Airport (BRI)", type: "trans", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=400", map: "Bari Karol WojtyÅ‚a Airport" }
                ]
            }
        ];

        // === ç¨‹å¼æ ¸å¿ƒé‚è¼¯ ===
        let currentDayIdx = 0;
        let expenses = JSON.parse(localStorage.getItem('myExpensesV2')) || [];
        let inputCurrency = 'EUR'; // é è¨­è¼¸å…¥å¹£åˆ¥

        // åˆå§‹åŒ–
        function init() {
            renderHeader();
            renderTimeline();
            renderExpenses();
        }

        // 1. æ¸²æŸ“ Header (æ—¥æœŸæ»‘å‹•)
        function renderHeader() {
            const container = document.getElementById('dateTabs');
            container.innerHTML = itinerary.map((day, idx) => {
                const activeClass = idx === currentDayIdx ? 'active' : '';
                return `
                <div class="date-card ${activeClass}" onclick="switchDay(${idx})">
                    <div style="font-size:16px; font-weight:bold;">D${idx+1}</div>
                    <div style="font-size:10px;">${day.date}</div>
                </div>`;
            }).join('');
            
            // æ›´æ–°é—œéµå­—èˆ‡å¤©æ°£
            document.getElementById('dailyHighlight').innerHTML = itinerary[currentDayIdx].highlight;
            document.getElementById('dailyWeather').innerHTML = itinerary[currentDayIdx].weather;
            document.getElementById('dayCount').innerText = currentDayIdx + 1;
        }

        function switchDay(idx) {
            currentDayIdx = idx;
            renderHeader();
            renderTimeline();
        }

        // 2. æ¸²æŸ“è¡Œç¨‹
        function renderTimeline() {
            const container = document.getElementById('timelineList');
            const dayData = itinerary[currentDayIdx];
            
            // å®šç¾©æ¨™ç±¤é¡è‰²èˆ‡åœ–ç¤º
            const types = {
                'spot': { color: 'var(--tag-spot)', icon: 'camera', text: 'æ™¯é»' },
                'food': { color: 'var(--tag-food)', icon: 'utensils', text: 'ç¾é£Ÿ' },
                'coffee': { color: 'var(--tag-coffee)', icon: 'mug-hot', text: 'å’–å•¡' },
                'trans': { color: 'var(--tag-trans)', icon: 'bus', text: 'äº¤é€š' },
                'hotel': { color: '#B0B8BA', icon: 'bed', text: 'ä½å®¿' }
            };

            container.innerHTML = dayData.items.map(item => {
                const t = types[item.type] || types['spot'];
                return `
                <div class="timeline-item">
                    <div class="time-badge">${item.time}</div>
                    <div class="trip-card">
                        <div class="tag" style="background:${t.color}">
                            <i class="fas fa-${t.icon}"></i> ${t.text}
                        </div>
                        <img src="${item.img}" class="trip-img">
                        <div class="trip-content">
                            <div class="trip-title">${item.title}</div>
                            <div class="trip-desc">${item.desc}</div>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.map)}" target="_blank" class="nav-btn-sm">
                                <i class="fas fa-location-arrow"></i> å°èˆª
                            </a>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // 3. è¨˜å¸³é‚è¼¯
        function setCurrency(curr) {
            inputCurrency = curr;
            document.getElementById('btnEur').className = curr === 'EUR' ? 'c-btn active' : 'c-btn';
            document.getElementById('btnTwd').className = curr === 'TWD' ? 'c-btn active' : 'c-btn';
            
            // æç¤ºplaceholder
            document.getElementById('exPrice').placeholder = curr === 'EUR' ? 'é‡‘é¡ (â‚¬)' : 'é‡‘é¡ (NT$)';
        }

        function saveExpense() {
            const item = document.getElementById('exItem').value;
            let price = parseFloat(document.getElementById('exPrice').value);
            const cat = document.getElementById('exCat').value;
            const payer = document.getElementById('exPayer').value;

            if(!item || !price || !payer) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");

            // å¦‚æœè¼¸å…¥å°å¹£ï¼Œæ›ç®—æˆæ­å…ƒå„²å­˜ (æ–¹ä¾¿çµ±ä¸€è¨ˆç®—)
            // å‡è¨­åŒ¯ç‡ 35
            let priceEur = price;
            if (inputCurrency === 'TWD') {
                priceEur = price / 35;
            }

            expenses.push({ 
                item, 
                price: priceEur, // çµ±ä¸€å­˜æ­å…ƒ
                cat, 
                payer, 
                id: Date.now() 
            });
            
            localStorage.setItem('myExpensesV2', JSON.stringify(expenses));
            closeModal();
            renderExpenses();
            
            // æ¸…ç©º
            document.getElementById('exItem').value = '';
            document.getElementById('exPrice').value = '';
        }

        function renderExpenses() {
            const list = document.getElementById('expenseList');
            let totalEur = 0;
            
            // çµç®—è®Šæ•¸
            let malePaid = 0;
            let femalePaid = 0;
            
            const catIcons = {
                'food': 'utensils', 'trans': 'bus', 'shop': 'bag-shopping',
                'hotel': 'bed', 'ticket': 'ticket', 'other': 'star'
            };

            list.innerHTML = expenses.map(ex => {
                totalEur += ex.price;
                if(ex.payer === 'male') malePaid += ex.price;
                if(ex.payer === 'female') femalePaid += ex.price;
                
                let payerText = ex.payer === 'male' ? '<span style="color:#7CA1B5">ğŸ¤µ ç”·æ–¹</span>' : '<span style="color:#D4A5A5">ğŸ‘° å¥³æ–¹</span>';
                
                return `
                <div class="expense-item">
                    <div style="display:flex; align-items:center;">
                        <div class="cat-icon"><i class="fas fa-${catIcons[ex.cat]||'star'}"></i></div>
                        <div>
                            <div style="font-weight:bold; color:var(--text);">${ex.item}</div>
                            <div style="font-size:12px; color:#999;">${payerText}</div>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:bold;">â‚¬${ex.price.toFixed(1)}</div>
                        <i class="fas fa-trash" style="color:#ddd; font-size:12px; margin-top:5px;" onclick="delExpense(${ex.id})"></i>
                    </div>
                </div>`;
            }).join('');

            // æ›´æ–°ç¸½é‡‘é¡
            document.getElementById('displayTotal').innerText = totalEur.toFixed(1);
            document.getElementById('displayTotalTwd').innerText = Math.round(totalEur * 35).toLocaleString();

            // === è‡ªå‹•çµç®—é‚è¼¯ (Splitwise) ===
            // å‡è¨­å…©äººå¹³åˆ†ç¸½èŠ±è²»
            let shouldBePaidPerPerson = totalEur / 2;
            let maleDiff = malePaid - shouldBePaidPerPerson; // ç”·æ–¹å¤šä»˜äº†å¤šå°‘

            let resultHtml = "";
            if (Math.abs(maleDiff) < 1) {
                resultHtml = "ç›®å‰å¸³ç›®å…©æ¸…ï¼Œå®Œç¾ï¼âœŒï¸";
            } else if (maleDiff > 0) {
                // ç”·æ–¹å¤šä»˜ï¼Œå¥³æ–¹è¦çµ¦ç”·æ–¹
                resultHtml = `ğŸ‘° å¥³æ–¹éœ€çµ¦ç”·æ–¹ <b style="color:var(--primary)">â‚¬${maleDiff.toFixed(1)}</b> (ç´„ NT$${Math.round(maleDiff*35)})`;
            } else {
                // ç”·æ–¹å°‘ä»˜ï¼Œç”·æ–¹è¦çµ¦å¥³æ–¹
                let owe = Math.abs(maleDiff);
                resultHtml = `ğŸ¤µ ç”·æ–¹éœ€çµ¦å¥³æ–¹ <b style="color:var(--accent)">â‚¬${owe.toFixed(1)}</b> (ç´„ NT$${Math.round(owe*35)})`;
            }
            document.getElementById('settleResult').innerHTML = resultHtml;
        }

        function delExpense(id) {
            if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('myExpensesV2', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        // ä»‹é¢åˆ‡æ›
        function switchView(viewId, btn) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById('view-'+viewId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
        }

        function openModal() { document.getElementById('addModal').classList.add('open'); }
        function closeModal() { document.getElementById('addModal').classList.remove('open'); }

        // ç¿»è­¯
        function openGoogleTrans(s, t) {
            window.open(`https://translate.google.com/?sl=${s}&tl=${t}&op=translate`, '_blank');
        }
        function speak(txt) {
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'it-IT';
            speechSynthesis.speak(u);
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
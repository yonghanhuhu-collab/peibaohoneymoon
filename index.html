<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å—ç¾©èœœæœˆä¹‹æ—… ğŸ‡®ğŸ‡¹</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6B4EFF; /* å½±ç‰‡ä¸­çš„ç´«è‰²ç³» */
            --bg: #F4F6F8;
            --white: #FFFFFF;
            --text: #333333;
            --gray: #888888;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        
        /* é ‚éƒ¨å°èˆª */
        .header { background: var(--primary); color: var(--white); padding: 20px 20px 60px 20px; border-radius: 0 0 20px 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(107, 78, 255, 0.3); }
        .header h1 { margin: 0; font-size: 24px; font-weight: 700; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 14px; }

        /* æ—¥æœŸåˆ‡æ› Tab (åƒå½±ç‰‡é‚£æ¨£) */
        .date-tabs { display: flex; overflow-x: auto; padding: 0 15px; margin-top: -40px; gap: 10px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .date-tabs::-webkit-scrollbar { display: none; }
        .tab-btn { background: var(--white); border: none; padding: 10px 15px; border-radius: 12px; min-width: 70px; text-align: center; color: var(--gray); font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: all 0.2s; flex-shrink: 0; }
        .tab-btn.active { background: var(--primary); color: var(--white); transform: scale(1.05); box-shadow: 0 4px 10px rgba(107, 78, 255, 0.4); }
        .tab-date { font-size: 12px; display: block; opacity: 0.8; }
        .tab-day { font-size: 16px; display: block; }

        /* è¡Œç¨‹å¡ç‰‡ */
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        
        .card { background: var(--white); border-radius: 16px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; gap: 15px; align-items: center; position: relative; overflow: hidden; }
        .card img { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; background: #eee; }
        .card-content { flex: 1; }
        .time-badge { background: #EEEAFF; color: var(--primary); padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 5px; }
        .card h3 { margin: 0 0 5px 0; font-size: 16px; }
        .card p { margin: 0; color: var(--gray); font-size: 13px; }
        .nav-btn { background: #f0f0f0; border: none; width: 36px; height: 36px; border-radius: 50%; color: var(--primary); display: flex; align-items: center; justify-content: center; text-decoration: none; }

        /* é ç®—è¨˜å¸³å€ */
        .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .total-box { background: var(--white); padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); flex: 1; margin: 0 5px; }
        .total-label { font-size: 12px; color: var(--gray); }
        .total-amount { font-size: 24px; font-weight: 800; color: var(--primary); margin: 5px 0; }
        .currency { font-size: 14px; color: #666; }

        .add-btn { position: fixed; bottom: 90px; right: 20px; background: var(--primary); color: white; width: 56px; height: 56px; border-radius: 50%; border: none; box-shadow: 0 4px 15px rgba(107, 78, 255, 0.4); font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 90; }

        /* åº•éƒ¨å°èˆªåˆ— */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--white); display: flex; justify-content: space-around; padding: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; }
        .nav-item { border: none; background: none; color: var(--gray); font-size: 12px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ç°¡å–®çš„è¼¸å…¥å½ˆçª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: flex-end; }
        .modal.open { display: flex; }
        .modal-content { background: var(--white); width: 100%; padding: 20px; border-radius: 20px 20px 0 0; animation: slideUp 0.3s; }
        .form-group { margin-bottom: 15px; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
        .btn-submit { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <h1>å—ç¾©èœœæœˆ ğŸ‡®ğŸ‡¹</h1>
        <p>3/28 - 4/05 â€¢ æµªæ¼«ä¹‹æ—…</p>
    </div>

    <div id="itinerary-view" class="section active">
        <div class="date-tabs" id="dateTabs"></div>
        
        <div class="container" id="timelineContainer">
            </div>
    </div>

    <div id="budget-view" class="section">
        <div class="container">
            <div class="budget-header">
                <div class="total-box">
                    <div class="total-label">ç¸½èŠ±è²» (EUR)</div>
                    <div class="total-amount" id="totalEur">0</div>
                </div>
                <div class="total-box">
                    <div class="total-label">æŠ˜åˆå°å¹£ (TWD)</div>
                    <div class="total-amount" id="totalTwd">0</div>
                    <div class="currency">åŒ¯ç‡: 35</div>
                </div>
            </div>

            <div id="expenseList">
                </div>
        </div>
        <button class="add-btn" onclick="openModal()">+</button>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchView('itinerary')">
            <i class="fas fa-map-marked-alt"></i> è¡Œç¨‹
        </button>
        <button class="nav-item" onclick="switchView('budget')">
            <i class="fas fa-wallet"></i> è¨˜å¸³
        </button>
    </div>

    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <h3>æ–°å¢æ¶ˆè²»</h3>
            <div class="form-group">
                <input type="text" id="itemName" class="form-control" placeholder="é …ç›® (ä¾‹å¦‚: å†°æ·‡æ·‹)">
            </div>
            <div class="form-group">
                <input type="number" id="itemPrice" class="form-control" placeholder="é‡‘é¡ (æ­å…ƒ)">
            </div>
            <div class="form-group">
                <select id="payer" class="form-control">
                    <option value="å…¬é‡‘">å…¬é‡‘</option>
                    <option value="ç”·æ–¹">ç”·æ–¹</option>
                    <option value="å¥³æ–¹">å¥³æ–¹</option>
                </select>
            </div>
            <button class="btn-submit" onclick="addExpense()">å„²å­˜</button>
            <div style="text-align:center; margin-top:15px; color:#888;" onclick="closeModal()">å–æ¶ˆ</div>
        </div>
    </div>

    <script>
        // === 1. è³‡æ–™åº«ï¼šä½ çš„å—ç¾©è¡Œç¨‹è³‡æ–™ (æˆ‘å¹«ä½ å¡«å¥½äº†) ===
        const itineraryData = [
            { date: "3/28", day: "äº”", time: "14:00", title: "æŠµé”æ‹¿å¡é‡Œ", desc: "å‰å¾€è˜‡é€£å¤š", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Panorama_di_Napoli.jpg/640px-Panorama_di_Napoli.jpg", map: "https://www.google.com/maps/search/?api=1&query=Naples+Airport" },
            { date: "3/28", day: "äº”", time: "16:00", title: "å…¥ä½è˜‡é€£å¤šæµ·æ™¯é£¯åº—", desc: "é˜¿ç‘ªè²åŸºåœ°", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Sorrento_Piazza_Tasso_v2.jpg/640px-Sorrento_Piazza_Tasso_v2.jpg", map: "https://www.google.com/maps/search/?api=1&query=Sorrento" },
            { date: "3/29", day: "å…­", time: "09:00", title: "å‰å¾€å¡å¸ƒé‡Œå³¶", desc: "æ­èˆ¹å‡ºç™¼", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Capri_Harbour.jpg/640px-Capri_Harbour.jpg", map: "https://www.google.com/maps/search/?api=1&query=Capri+Port" },
            { date: "3/29", day: "å…­", time: "11:00", title: "è—æ´ Blue Grotto", desc: "ä¸Šå¸èª¿å¥½çš„è—", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Grotta_Azzurra_II.jpg/640px-Grotta_Azzurra_II.jpg", map: "https://www.google.com/maps/search/?api=1&query=Blue+Grotto" },
            { date: "3/30", day: "æ—¥", time: "10:00", title: "æ³¢è¥¿å¡”è«¾", desc: "æœ€ç¾å±±åŸ", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Positano_Italy.jpg/640px-Positano_Italy.jpg", map: "https://www.google.com/maps/search/?api=1&query=Positano" },
            { date: "3/31", day: "ä¸€", time: "09:00", title: "å‰å¾€é¦¬æ³°æ‹‰", desc: "çŸ³é ­åŸå‡ºç™¼", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Matera_Sassi_2016.jpg/640px-Matera_Sassi_2016.jpg", map: "https://www.google.com/maps/search/?api=1&query=Matera" },
            { date: "4/01", day: "äºŒ", time: "10:00", title: "æ´ç©´é£¯åº—é«”é©—", desc: "èœœæœˆå¿…ä½", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Matera_night.jpg/640px-Matera_night.jpg", map: "https://www.google.com/maps/search/?api=1&query=Matera+Hotel" },
            { date: "4/02", day: "ä¸‰", time: "14:00", title: "è˜‘è‡æ‘æ¼«æ­¥", desc: "Trulli ç«¥è©±å±‹", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/Trulli_Alberobello.jpg/640px-Trulli_Alberobello.jpg", map: "https://www.google.com/maps/search/?api=1&query=Alberobello" },
            { date: "4/03", day: "å››", time: "18:00", title: "æ´ç©´é¤å»³æ™šé¤", desc: "Grotta Palazzese", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Grotta_Palazzese_Restaurant.jpg/640px-Grotta_Palazzese_Restaurant.jpg", map: "https://www.google.com/maps/search/?api=1&query=Grotta+Palazzese" },
            { date: "4/04", day: "äº”", time: "10:00", title: "å·´é‡Œå¸‚å€è§€å…‰", desc: "è²“è€³æœµéºµè¡—", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Bari_lungomare.jpg/640px-Bari_lungomare.jpg", map: "https://www.google.com/maps/search/?api=1&query=Bari" }
        ];

        // === 2. ç¨‹å¼é‚è¼¯å€ ===
        
        // åˆå§‹åŒ–
        const dates = [...new Set(itineraryData.map(item => item.date))]; // æŠ“å‡ºæ‰€æœ‰æ—¥æœŸ
        let currentDate = dates[0];
        let expenses = JSON.parse(localStorage.getItem('myTripExpenses')) || []; // å¾æ‰‹æ©Ÿè®€å–èˆŠå¸³ç›®

        function renderTabs() {
            const container = document.getElementById('dateTabs');
            container.innerHTML = dates.map(date => {
                const dayData = itineraryData.find(d => d.date === date);
                return `<button class="tab-btn ${date === currentDate ? 'active' : ''}" onclick="changeDate('${date}')">
                    <span class="tab-date">${date}</span>
                    <span class="tab-day">${dayData.day}</span>
                </button>`;
            }).join('');
        }

        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            const todayItems = itineraryData.filter(item => item.date === currentDate);
            
            container.innerHTML = todayItems.map(item => `
                <div class="card" onclick="window.open('${item.map}', '_blank')">
                    <img src="${item.img}" alt="${item.title}">
                    <div class="card-content">
                        <span class="time-badge">${item.time}</span>
                        <h3>${item.title}</h3>
                        <p>${item.desc}</p>
                    </div>
                    <a href="${item.map}" target="_blank" class="nav-btn">
                        <i class="fas fa-location-arrow"></i>
                    </a>
                </div>
            `).join('');
        }

        function changeDate(date) {
            currentDate = date;
            renderTabs();
            renderTimeline();
        }

        // é é¢åˆ‡æ›
        function switchView(viewName) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            if(viewName === 'itinerary') {
                document.getElementById('itinerary-view').classList.add('active');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else {
                document.getElementById('budget-view').classList.add('active');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                renderExpenses();
            }
        }

        // è¨˜å¸³åŠŸèƒ½
        function renderExpenses() {
            const list = document.getElementById('expenseList');
            let total = 0;
            
            list.innerHTML = expenses.map((ex, index) => {
                total += parseFloat(ex.price);
                return `
                <div class="card" style="padding:10px;">
                    <div class="card-content">
                        <h3>${ex.name}</h3>
                        <p><span style="color:#6B4EFF">${ex.payer}</span> â€¢ ${ex.date}</p>
                    </div>
                    <div style="font-weight:bold; font-size:18px;">â‚¬${ex.price}</div>
                    <button onclick="deleteExpense(${index})" style="background:none; border:none; color:#ccc; margin-left:10px;">x</button>
                </div>`;
            }).join('');

            document.getElementById('totalEur').innerText = total.toLocaleString();
            document.getElementById('totalTwd').innerText = (total * 35).toLocaleString(); // åŒ¯ç‡35
        }

        function addExpense() {
            const name = document.getElementById('itemName').value;
            const price = document.getElementById('itemPrice').value;
            const payer = document.getElementById('payer').value;
            
            if(!name || !price) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");

            expenses.push({
                name: name,
                price: price,
                payer: payer,
                date: new Date().toLocaleDateString()
            });

            localStorage.setItem('myTripExpenses', JSON.stringify(expenses)); // å­˜åˆ°æ‰‹æ©Ÿ
            
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            closeModal();
            renderExpenses();
        }

        function deleteExpense(index) {
            if(confirm('ç¢ºå®šåˆªé™¤é€™ç­†èŠ±è²»ï¼Ÿ')) {
                expenses.splice(index, 1);
                localStorage.setItem('myTripExpenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function openModal() { document.getElementById('expenseModal').classList.add('open'); }
        function closeModal() { document.getElementById('expenseModal').classList.remove('open'); }

        // å•Ÿå‹• App
        renderTabs();
        renderTimeline();
    </script>
</body>
</html>